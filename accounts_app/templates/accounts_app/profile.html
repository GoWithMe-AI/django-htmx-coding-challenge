{% extends "base.html" %}
{% load i18n %}

{% block content %}
<div class="container m-auto">
    <div class="w-full flex flex-col justify-center items-center">
        <h1 id="edit_profile_header" class="mt-10 text-xl">Welcome back, {{ user.full_name }}!</h1>
        <div class="mt-3 flex flex-col w-2/5 bg-white border border-gray-200 shadow-sm rounded-xl p-4 md:p-5 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400">
            <form
                id="edit_profile_form"
                hx-post="{% url 'home' %}"
                hx-trigger="submit"
                hx-swap="multi:#edit_profile_form:outerHTML,#edit_profile_header:outerHTML,#navbar_account:outerHTML"
            >
                {% csrf_token %}
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">Email</label>
                    <input
                        type="email"
                        id="email"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600"
                        value="{{ user.email }}"
                        disabled
                    >
                </div>
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">First Name</label>
                    <input
                        type="text"
                        id="first_name"
                        name="first_name"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-primary-500 disabled:opacity-50 disabled:pointer-events-none"
                        value="{{ form.first_name.value }}"
                        required
                    >
                </div>
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">Last Name</label>
                    <input
                        type="text"
                        id="last_name"
                        name="last_name"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-primary-500 disabled:opacity-50 disabled:pointer-events-none"
                        value="{{ form.last_name.value }}"
                        required
                    >
                </div>
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">Occupation</label>
                    <input
                        type="text"
                        id="occupation"
                        name="occupation"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-primary-500 disabled:opacity-50 disabled:pointer-events-none"
                        value="{{ form.occupation.value }}"
                        required
                    >
                </div>
                <div class="flex justify-center">
                    <button
                        type="submit"
                        class="mt-5 m-auto py-3 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-primary text-white hover:bg-primary-700 focus:outline-none focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"
                    >
                        Update Profile
                    </button>
                </div>
            </form>
        </div>
        <div class="mt-4 text-center">
            <button type="button"
                    class="text-sm text-primary hover:text-primary-700 font-medium"
                    data-hs-overlay="#invite-user-modal">
                Invite User
            </button>
        </div>
    </div>
</div>

<!-- Include navbar account for HTMX swap - hidden but in response for multi-swap -->
<div style="display: none;">
    {% include "navbar/account.html" %}
</div>
{% endblock content %}

{% block modals %}
<!-- Invite User Modal -->
<div id="invite-user-modal" class="hs-overlay hidden size-full fixed top-0 start-0 z-[80] overflow-x-hidden overflow-y-auto pointer-events-none" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; z-index: 9999 !important; width: 100vw !important; height: 100vh !important;">
    <div class="hs-overlay-open:mt-7 hs-overlay-open:opacity-100 hs-overlay-open:duration-500 mt-0 opacity-0 ease-out transition-all sm:max-w-md sm:w-full m-3 sm:mx-auto min-h-[calc(100%-3.5rem)] flex items-center justify-center" style="opacity: 1 !important; z-index: 10000 !important;">
        <div class="w-full flex flex-col bg-white border border-gray-200 rounded-xl shadow-sm dark:bg-gray-800 dark:border-gray-700 overflow-hidden pointer-events-auto" style="opacity: 1 !important; background-color: white !important; display: flex !important; visibility: visible !important;" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700">
                <h3 class="font-bold text-gray-800 dark:text-white">
                    Invite User
                </h3>
                <button type="button"
                        id="close-modal-x-btn"
                        class="flex justify-center items-center size-7 text-sm font-semibold rounded-full border border-transparent text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none dark:text-white dark:hover:bg-gray-700 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"
                        data-hs-overlay-close="#invite-user-modal"
                        onclick="const modal = document.getElementById('invite-user-modal'); if (modal) { modal.classList.add('hidden'); modal.classList.remove('open', 'opened'); const backdrop = document.querySelector('.hs-overlay-backdrop'); if (backdrop) { backdrop.remove(); } }">
                    <span class="sr-only">Close</span>
                    <svg class="flex-shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m18 6-12 12"></path>
                        <path d="m6 6 12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="invite-user-modal-content" class="p-4">
                {% include "accounts_app/invite_modal_content.html" %}
            </div>
        </div>
    </div>
</div>

<script>
    // Handle backdrop clicks to close modal
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('invite-user-modal');
        
        if (modal) {
            // Close modal when clicking on backdrop
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                    modal.classList.remove('open', 'opened');
                    const backdrop = document.querySelector('.hs-overlay-backdrop');
                    if (backdrop) {
                        backdrop.remove();
                    }
                }
            });
        }
    });
</script>
{% endblock modals %}